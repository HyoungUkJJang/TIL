1. 쓰레드란?
- 애플리케이션 코드를 하나하나 순차적으로 실행하는 것은 쓰레드
- 자바 메인 메서드를 처음 실행하면 main이라는 이름의 쓰레드가 실행된다.
- 쓰레드가 없다면 자바 애플리케이션 실행이 불가능하다.
- 쓰레드는 한번에 하나의 코드 라인만 수행한다.
- 동시 처리가 필요하면 쓰레드를 추가 생성한다.


2.단일 쓰레드 - 하나의 요청만 수행하고 처리하고 있을 경우 다른 요청이 오면 기다리게 된다.
 > 요청 마다 쓰레드를 새로 생성해준다면 ?
   [장점]
   1. 동시 요청을 처리할 수 있다.
   2. 리소스(CPU, 메모리)가 허용할 때 까지 처리가능하다.
   3. 하나의 쓰레드가 지연 되어도, 나머지 쓰레드는 정상 동작한다
   
   [단점]
   1. 쓰레드 생성 비용은 매우 비싸다. (요청이 올때마다 쓰레드를 생성하면 응답속도가 느려진다.)
   2. 쓰레드는 컨텍스트 스위칭 비용이 발생한다. ( CPU의 코어당 스레드가 번갈아가며 진행되는데 속도가 빨라 동시 처리처럼 보이지만 스위칭 되면서 작업이 이루어지는데 이때 비용이 발생 )
   3. 쓰레드 생성에 제한이 없다. ( 고객 요청이 많이오면 CPU, 메모리 임계점을 넘어서 서버가 죽을 가능성이 있다.)


3. 쓰레드 풀 - 풀장처럼 공간안에 쓰레드를 미리 생성해두고 요청이 들어올 때마다 놀고있는 스레드를 요청한다. 요청이 끝나면 죽이는게 아니라 쓰레드 풀에 다시 반납.
          - 다 사용하면 대기 및 거절을 할 수 있음.

[특징]
1. 필요한 쓰레드를 쓰레드 풀에 보관하고 관리함
2. 쓰레드 풀에 생성 가능한 쓰레드의 최대치를 관리한다. 톰캣은 최대 200개 기본설정
[사용]
1. 쓰레드가 필요하면 이미 생성되어 있는 쓰레드를 쓰레드 풀에 빌려서 사용한다.
2. 사용을 종료하면 빌렸기 때문에 쓰레드 풀에 다시 반납해줘야함
3. 최대 쓰레드까지 모두 사용중이면 거절하거나 특정 숫자만큼 대기열을 줄 수 있다.
[장점]
1. 쓰레드가 미리 생성이 되어있어서 생성하고 종료하는(CPU)비용이 절약되고 응답시간이 빠르다
2. 생성 가능한 쓰레드의 최대치가 있으므로 너무 많은 요청이 들어와도 기존 요청은 안전하게 처리할 수 있다.
[실무 팁]
1. WAS의 주요 튜닝 포인트는 최대 쓰레드(max thread) 수이다.
2. 이 값을 너무 낮게 설정하면?
   - 동시 요청이 많으면, 서버 리소스는 여유롭지만 클라이언트는 금방 응답 지연이 발생함
3. 이 값을 너무 높게 설정하면?
   - 동시 요청이 많으면, CPU, 메모리 리소스 임계점 초과로 서버 다운됨
4. 장애 발생시?
   - 클라우드라면 일단 서버부터 늘리고 이후에 튜닝한다.
   - 클라우드가 아니면 열심히 튜닝한다.
    
[쓰레드 풀의 적정 숫자는 어떻게 찾을까?]
- 애플리케이션 로직의 복잡도, CPU, 메모리, IO리소스 상황에 따라 모두 다르다.
- 성능 테스트
  > 최대한 실제 서비스와 유사하게 성능 테스트를 시도한다.
  > 툴 : 아파치 ab, 제이미터, nGrinder(*)
 
 4. WAS의 멀티 쓰레드 지원 핵심
 - 멀티 쓰레드에 대한 부분은 WAS가 처리
 - 개발자가 멀티 쓰레드 관련 코드를 신경쓰지 않아도된다. (was의 가장 큰 장점)
 - 개발자는 마치 싱글 쓰레드 프로그래밍을 하듯이 편리하게 소스 코드를 개발
 - 멀티 쓰레드 환경 이므로 싱글톤 객체(서블릿, 스프링빈)는 주의해서 사용

 



